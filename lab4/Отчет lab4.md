University: [ITMO University](https://itmo.ru/ru/)

Faculty: [FTMI](https://ftmi.itmo.ru)

Course: [Cloud platforms as the basis of technology entrepreneurship](https://itmo-ict-faculty.github.io/cloud-platforms-as-the-basis-of-technology-entrepreneurship/education/labs2023-2024/lab1/lab1/#_2)

Year: 2025/2026

Group: HBM

Author: Бойко Екатерина Олеговна

Lab: Lab4

Date of create: 01.12.2025

Date of finished: 02.12.2025


# Лабораторная работа №4  

**Разработка инфраструктуры MVP AI-приложения**  

Название приложения: "SmartCaption" (Сервис генерации подписей к изображениям с помощью AI).

Функциональность:

- Пользователь загружает изображение через веб-интерфейс.

- Изображение отправляется на обработку AI-моделью.

- AI-модель генерирует несколько вариантов подписей (текста).

- Результаты (изображение + подписи) сохраняются и отображаются пользователю.

## 1. Начальный этап

**Архитектура:**
- Frontend: Cloud Storage 
- Backend: Cloud Functions - функции запускаются в ответ на конкретные триггеры из различных сервисов Google Cloud, без необходимости контейнеризации.
- AI-модель: Внешний API (Hugging API) Подробнее: ![https://huggingface.co/docs/inference-providers/hub-api](https://huggingface.co/docs/inference-providers/hub-api),
OpenAI GPT-4 Vision
- Хранение данных: Cloud Storage
- База данных: не используется

**Описание:**  
Минимальная конфигурация с внешним AI и без БД. Все данные хранятся в Cloud Storage. Простой способ быстро протестировать гипотезу.

**Финансовые расчёты:** 
Нагрузка: 100 запросов в день (3000 в месяц).

Cloud Storage: Практически бесплатно при таком объеме (менее $0.10 в месяц).

Cloud Functions (Backend): 3000 вызовов. Попадают в бесплатный лимит. ($0)

Внешний AI API: Зависит от API. Если принять $0.01 за вызов: 0.01$, то 30$ в месяц.

ИТОГО (месяц): ~31 USD

**Схема:** 
<img width="440" height="293" alt="image" src="https://github.com/user-attachments/assets/dd0910bd-5500-453e-b3d6-c67481484af9" />

Архитектура упрощенная: используются бессерверные и полностью управляемые сервисы, а самый большой расход — на внешний AI-сервис, что является приемлемой платой за скорость и отсутствие необходимости обучать собственную модель.

## 2. Этап тестирования с партнёрами

**Архитектура:**
- Frontend: Cloud Storage + Cloud CDN
- Backend: Cloud Run (Python)
- AI-модель: Hugging Face API/ OpenAI GPT-4 Vision
- База данных: Cloud FireStore - Внедряем NoSQL БД для быстрого хранения метаданных пользователя, истории запросов и результатов. Позволяет легко масштабироваться и соответствует гибким требованиям тестирования.
- Мониторинг: Cloud Logging

**Описание:**  
Добавлена балансировка, логирование и NoSQL БД. Приложение развернуто на App Engine, не требует контейнеров. Подходит для тестирования на реальных пользователях.

**Финансовые расчёты:** 

Нагрузка: 10 000 запросов в день (300 000 в месяц)

Cloud Run (Backend): значительное увеличение вызовов - 50$ в месяц

Cloud Firestore: в пределах бесплатного лимита или небольшие расходы на чтение/запись - 10$ в месяц

Cloud CDN: небольшие расходы на исходящий трафик - 5$ в месяц

Внешний AI API: 0.01$ * times 300 000 = 3000$ в месяц

ИТОГО (месяц): ~3065 USD

**Схема:**

<img width="765" height="373" alt="image" src="https://github.com/user-attachments/assets/104cda5a-b8ea-436d-a3ea-c66b9ade1366" />

На этом этапе стоимость внешнего AI становится доминирующей. Это является критическим моментом для переноса инференса на собственную, более дешевую инфраструктуру (например, Vertex AI) для продакшн-версии.


## 3. Прод решение

**Архитектура:**
- Frontend: Cloud CDN + Cloud Storage
- Backend: Cloud Run
- Асинхронные задачи: Pub/Sub (Очередь) + Cloud Run Jobs
- AI-модель: Vertex AI Prediction 
- База данных: Cloud Bigtable (NoSQL) - переход на высокомасштабируемую БД для хранения миллионов результатов и метаданных.
- Безопасность и аналитика: Cloud Logging, Cloud Armor (обязательно для публичного продакшн-решения)

Инфраструктура автоматизирована. Используются Jobs, масштабируемая Bigtable и компоненты безопасности. Инференс перенесён на Vertex AI.

**Финансовые расчёты:** 
Нагрузка: 500 000 запросов в день (15 000 000 в месяц)

Cloud Run / Pub/Sub - 100$ в месяц

Cloud Bigtable - 500$ в месяц

Vertex AI Prediction (Инференс): собственный инференс на оптимизированных машинах с GPU значительно дешевле, чем внешний API - 1500$-2500$ в месяц

Cloud Armor/CDN/Logging - 50$ в месяц

ИТОГО (месяц): ~2150 USD - 3150 USD (значительно дешевле, чем этап тестирования, несмотря на в 50 раз большую нагрузку, за счет переноса инференса на собственный оптимизированный сервис)

**Схема:**
<img width="648" height="267" alt="image" src="https://github.com/user-attachments/assets/ba97324f-754b-41a6-8c2a-5bfaaa846d8e" />

Используются автоматизированные и масштабируемые компоненты. Kubernetes не требуется. Решение устойчиво к нагрузке и готово к продакшн-использованию. Переход на Vertex AI Prediction и асинхронную архитектуру с Pub/Sub и Cloud Run Jobs позволил резко снизить удельные затраты и обеспечить высокую масштабируемость и отказоустойчивость.

## Выводы

Была разработана архитектура AI-приложения на трёх этапах жизненного цикла. 

Для PoC выбрано простейшее решение без БД и собственной модели. 

На этапе тестирования добавлены балансировка, база данных и логирование. 

Продовая версия построена на облачных компонентах с автоматизацией процессов, масштабируемым хранилищем и встроенной безопасностью. Такой подход позволяет оптимизировать расходы и развивать систему по мере роста.
